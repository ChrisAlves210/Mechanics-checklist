<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mechanics Checklist</title>
    <style>
      :root {
        --bg: #0f172a; /* slate-900 */
        --card: #111827; /* gray-900 */
        --text: #e5e7eb; /* gray-200 */
        --muted: #9ca3af; /* gray-400 */
        --accent: #22c55e; /* green-500 */
        --danger: #ef4444; /* red-500 */
        --border: #1f2937; /* gray-800 */
      }
      html, body { height: 100%; }
      body {
        margin: 0; background: var(--bg); color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
        display: flex; align-items: center; justify-content: center; padding: 24px;
      }
      .wrapper { width: 100%; max-width: 720px; }
      .card {
        background: var(--card); border: 1px solid var(--border); border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      }
      .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display:flex; gap:12px; align-items:center; }
      h1 { font-size: 20px; margin: 0; letter-spacing: 0.2px; }
      .sub { color: var(--muted); font-size: 13px; }
      .controls { margin-left: auto; display:flex; gap:8px; }
      .btn {
        background: transparent; border: 1px solid var(--border); color: var(--text);
        padding: 8px 12px; border-radius: 8px; cursor: pointer;
      }
      .btn:hover { border-color: var(--muted); }
      .btn-accent { background: var(--accent); border: none; color: #062e0f; }
      .btn-danger { background: var(--danger); border: none; color: #3b0c0c; }
      .card-body { padding: 20px 24px; }
      .row { display:flex; gap:10px; }
      .row input[type="text"] {
        flex:1; background: #0b1220; color: var(--text); border: 1px solid var(--border);
        border-radius: 8px; padding: 10px 12px;
      }
      ul { list-style: none; padding: 0; margin: 16px 0 0; }
      li { display:flex; align-items:center; gap:10px; padding: 10px 8px; border-bottom: 1px solid var(--border); }
      li:last-child { border-bottom: none; }
      .item-text { flex:1; }
      .item-text.completed { color: var(--muted); text-decoration: line-through; }
      .badge { font-size: 12px; color: var(--muted); }
      .empty { color: var(--muted); text-align: center; padding: 24px; border: 1px dashed var(--border); border-radius: 10px; }
      .filters { display:flex; gap:10px; margin-top: 12px; }
      .filter { font-size: 13px; color: var(--muted); cursor: pointer; }
      .filter.active { color: var(--text); }
    </style>
  </head>
  <body>
    <nav style="position:fixed;top:8px;left:8px;right:8px;text-align:center;z-index:10">
      <a href="{{ url_for('main.dashboard') }}" style="color:#e5e7eb">Dashboard</a> |
      <a href="{{ url_for('main.checklist') }}" style="color:#e5e7eb">Checklist</a> |
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('auth.logout') }}" style="color:#e5e7eb">Logout</a>
      {% else %}
        <a href="{{ url_for('auth.login') }}" style="color:#e5e7eb">Login</a> |
        <a href="{{ url_for('auth.signup') }}" style="color:#e5e7eb">Sign Up</a>
      {% endif %}
    </nav>
    <div class="wrapper">
      <div class="card" role="region" aria-label="Mechanics Checklist">
        <div class="card-header">
          <div>
            <h1>Mechanics Checklist</h1>
            <div class="sub" id="stats">0 items · 0 completed</div>
          </div>
          <div class="controls">
            <button class="btn btn-danger" id="clearCompletedBtn" title="Remove completed items">Clear Completed</button>
          </div>
        </div>
        <div class="card-body">
          <div class="row" aria-label="Add checklist item">
            <input type="text" id="newItem" placeholder="Add an item (e.g., Change oil, Inspect brakes)" />
            <button class="btn btn-accent" id="addBtn">Add</button>
          </div>
          <div class="filters" aria-label="Filters">
            <span class="filter active" data-filter="all">All</span>
            <span class="filter" data-filter="active">Active</span>
            <span class="filter" data-filter="completed">Completed</span>
          </div>
          <ul id="list" aria-live="polite"></ul>
          <div class="empty" id="emptyState" hidden>
            No items yet. Add your first task above.
          </div>
        </div>
      </div>
    </div>

    <script>
      const STORAGE_KEY = 'mechanics_checklist_items';
      const listEl = document.getElementById('list');
      const newItemEl = document.getElementById('newItem');
      const addBtn = document.getElementById('addBtn');
      const statsEl = document.getElementById('stats');
      const emptyEl = document.getElementById('emptyState');
      const clearCompletedBtn = document.getElementById('clearCompletedBtn');
      const filterEls = Array.from(document.querySelectorAll('.filter'));

      let items = [];
      let currentFilter = 'all';

      function load() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          items = raw ? JSON.parse(raw) : [];
        } catch (e) {
          items = [];
        }
        render();
      }

      function persist() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      }

      function addItem(text) {
        const trimmed = text.trim();
        if (!trimmed) return;
        items.push({ id: crypto.randomUUID(), text: trimmed, done: false });
        persist();
        render();
      }

      function toggleItem(id) {
        items = items.map(i => (i.id === id ? { ...i, done: !i.done } : i));
        persist();
        render();
      }

      function removeItem(id) {
        items = items.filter(i => i.id !== id);
        persist();
        render();
      }

      function clearCompleted() {
        items = items.filter(i => !i.done);
        persist();
        render();
      }

      function setFilter(key) {
        currentFilter = key;
        filterEls.forEach(el => el.classList.toggle('active', el.dataset.filter === key));
        render();
      }

      function filteredItems() {
        if (currentFilter === 'active') return items.filter(i => !i.done);
        if (currentFilter === 'completed') return items.filter(i => i.done);
        return items;
      }

      function render() {
        const view = filteredItems();
        listEl.innerHTML = '';
        if (view.length === 0) {
          emptyEl.hidden = false;
        } else {
          emptyEl.hidden = true;
        }

        view.forEach(i => {
          const li = document.createElement('li');

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = i.done;
          checkbox.setAttribute('aria-label', 'Mark complete');
          checkbox.addEventListener('change', () => toggleItem(i.id));

          const span = document.createElement('span');
          span.className = 'item-text' + (i.done ? ' completed' : '');
          span.textContent = i.text;

          const del = document.createElement('button');
          del.className = 'btn';
          del.textContent = 'Delete';
          del.addEventListener('click', () => removeItem(i.id));

          li.appendChild(checkbox);
          li.appendChild(span);
          li.appendChild(del);
          listEl.appendChild(li);
        });

        const completed = items.filter(i => i.done).length;
        statsEl.textContent = `${items.length} items · ${completed} completed`;
      }

      addBtn.addEventListener('click', () => addItem(newItemEl.value));
      newItemEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') addItem(newItemEl.value);
      });
      clearCompletedBtn.addEventListener('click', clearCompleted);

      filterEls.forEach(el => {
        el.addEventListener('click', () => setFilter(el.dataset.filter));
      });


      load();
    </script>
  </body>
  </html>
